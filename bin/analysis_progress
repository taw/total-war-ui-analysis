#!/usr/bin/env ruby

require_relative "../lib/task_set"

task_set = TaskSet.new(*ARGV)

totals = Hash.new{|ht,k| ht[k] = [0,0] }

task_set.in_parallel do |task, i|
  next unless task.output_path.exist?
  totals[task.full_version][1] += task.data_size
  totals["*"][1] += task.data_size
  task.output_path.each_line do |line|
    next unless line =~ /\A(\d+)-(\d+) DataBlock/
    s = $1.to_i
    e = $2.to_i
    totals[task.full_version][0] += e-s
    totals["*"][0] += e-s
  end
end

puts "Unknown data:"
totals.sort.each do |k,(d,z)|
  pc = (100.0 * d.to_f / z).round(1)
  puts "#{k} - #{pc}%"
end
